<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ir_mbshr_kparrear_shr" language="groovy" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="ed9202ea-59c6-4485-b4b7-77fc621596a5">
	<property name="ireport.zoom" value="1.9487171000000016"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="as_coopid" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="as_reportid" class="java.lang.String"/>
	<parameter name="as_reportdetail" class="java.lang.String">
		<parameterDescription><![CDATA[]]></parameterDescription>
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="as_year" class="java.lang.String"/>
	<parameter name="as_entryid" class="java.lang.String"/>
	<parameter name="adtm_date" class="java.util.Date"/>
	<queryString>
		<![CDATA[select * from (select  mb.member_no, ft_getmbname(mb.coop_id, mb.member_no) as mem_name,
mg.membgroup_code, mg.membgroup_desc,mp.province_desc,
ft_calage(mb.member_date,$P{adtm_date},4) as work_age,

(select sharestk_amt * nvl(shsharetype.unitshare_value,10)
from shsharestatement
left join shsharetype on shsharetype.sharetype_code = '01'
where member_no = mb.member_no and seq_no =
(select max(seq_no) from shsharestatement where member_no = mb.member_no and slip_date <= $P{adtm_date} and shritemtype_code not in ('B/F') )
) as sharestk_value,

(select period from shsharestatement where member_no = mb.member_no and seq_no =
(select max(seq_no) from shsharestatement where member_no = mb.member_no and slip_date <= $P{adtm_date} and shritemtype_code not in ('B/F') )) as period

from mbmembmaster mb
left join kparrearreceive ka on  mb.member_no = ka.member_no and (substr(ka.recv_period,0,4) like $P{as_year}) and (ka.keepitemtype_code like 'S0%') and (ka.itemarrear_amt - ka.item_payment = 0)
left join  mbucfmembgroup mg on  mb.membgroup_code = mg.membgroup_code
left join mbucfprovince mp on  mg.province_code = mp.province_code
left join ( select member_no, sum(count_mem) as count_arr
	from   (select member_no, count( member_no) as count_mem
				from kparrearreceive
				where keepitemtype_code like 'S0%'
				group by member_no
				)
	group by member_no
) kc on mb.member_no = kc.member_no
where  ft_calage(mb.member_date,sysdate,4) > 0.3
and mb.coop_id = $P{as_coopid}
and mb.resign_status = 0
and mb.member_no not in ('00000000')) memlist
where work_age >= '0.6' and  period >= '6'
order by member_no ]]>
	</queryString>
	<field name="MEMBER_NO" class="java.lang.String"/>
	<field name="MEM_NAME" class="java.lang.String"/>
	<field name="MEMBGROUP_CODE" class="java.lang.String"/>
	<field name="MEMBGROUP_DESC" class="java.lang.String"/>
	<field name="PROVINCE_DESC" class="java.lang.String"/>
	<field name="WORK_AGE" class="java.lang.String"/>
	<field name="SHARESTK_VALUE" class="java.math.BigDecimal"/>
	<field name="PERIOD" class="java.math.BigDecimal"/>
	<group name="membgroup_code">
		<groupExpression><![CDATA[$F{MEMBGROUP_CODE}]]></groupExpression>
	</group>
	<group name="member_no">
		<groupExpression><![CDATA[$F{MEMBER_NO}]]></groupExpression>
	</group>
	<pageHeader>
		<band height="21" splitType="Stretch">
			<subreport>
				<reportElement uuid="86aa03c8-ffba-4108-abb1-92b86725b240" x="0" y="0" width="555" height="20"/>
				<subreportParameter name="as_coopid">
					<subreportParameterExpression><![CDATA[$P{as_coopid}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="as_reportid">
					<subreportParameterExpression><![CDATA[$P{as_reportid}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="as_entryid">
					<subreportParameterExpression><![CDATA[$P{as_entryid}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="as_reportdetail">
					<subreportParameterExpression><![CDATA[$P{as_reportdetail}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA["report_header\\ir_header_portrait.jasper"]]></subreportExpression>
			</subreport>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="25" splitType="Stretch">
			<staticText>
				<reportElement uuid="540b06b0-6eef-4540-8793-acaa9b20456f" x="0" y="0" width="49" height="25"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Angsana New" size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[ลำดับ]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="aa4a8e38-d683-4db9-8ff1-76040db604c7" x="49" y="0" width="90" height="25"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Angsana New" size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[เลขสมาชิก]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="e478a544-271a-431e-9c5f-0ab217c7bf6f" x="139" y="0" width="195" height="25"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Angsana New" size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[ชื่อ-สกุล]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="9dcd0896-4048-4539-9685-f658737d5116" x="334" y="0" width="60" height="25"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Angsana New" size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[อายุงาน]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="cb145aa3-8aac-41d5-8975-6f1d306c9b5d" x="464" y="0" width="91" height="25"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Angsana New" size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[หุ้นสะสม]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="e9ecec47-58bb-4067-be00-4c7e97d60221" x="394" y="0" width="70" height="25"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Angsana New" size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[งวดส่งหุ้น]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="40" splitType="Stretch">
			<textField>
				<reportElement uuid="7890fe17-958f-4a68-940e-5a9f555f89cb" x="0" y="0" width="49" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="13" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{REPORT_COUNT}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="8e7c880a-2945-4eae-9831-ece4ad4bb103" x="49" y="0" width="90" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="13" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{MEMBER_NO}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="4a159a14-c901-4089-8abf-07e92f604baa" x="139" y="0" width="195" height="20"/>
				<textElement>
					<font fontName="Angsana New" size="13" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{MEM_NAME}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="1771c664-13c3-4c10-9152-cfbb0465f127" x="334" y="0" width="60" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="13" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{WORK_AGE}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="6f594b29-8485-424d-bcff-3c3a24d289c9" x="0" y="20" width="555" height="20"/>
				<textElement>
					<font fontName="Angsana New" size="13" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{MEMBGROUP_CODE}+" - "+$F{MEMBGROUP_DESC} +" ("+$F{PROVINCE_DESC}+")"]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="0d5434fe-3772-47e5-831a-e0eb17b6831f" x="394" y="0" width="70" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="13" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{PERIOD}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement uuid="9e2caf2c-d52f-4335-a7b1-7e20920048ed" x="464" y="0" width="91" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="13" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{SHARESTK_VALUE}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
