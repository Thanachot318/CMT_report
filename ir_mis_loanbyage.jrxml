<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ir_mis_loanbyage" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="44f4954b-f8c5-45d7-ba3b-efdcae8f67a1">
	<property name="ireport.zoom" value="1.4641000000000006"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="as_coopid" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="adtm_date" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[select case when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) between 25 and 40 then '25 - 40'
 when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) between 41 and 50 then '41 - 50'
 when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) between 51 and 55 then '51 - 55'
 when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) between 56 and 60 then '56 - 60'
 when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) between 61 and 65 then '61 - 65'
 when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) >= 66 then '66'
 else '0' end as age,
 count(distinct mb.member_no) as a1,
 count(distinct lm.loancontract_no) as c1,
 sum(ls.principal_balance) as b1,
 cm.coop_name
from lncontmaster lm
inner join CMCOOPMASTER cm on lm.coop_id = cm.coop_id
left join lncontstatement ls on lm.loancontract_no = ls.loancontract_no
join (select max(seq_no) as seq_no , loancontract_no from lncontstatement
      where operate_date <= $P{adtm_date}
	AND ITEM_STATUS = 1 AND LOANITEMTYPE_CODE <> 'CL'
      group by loancontract_no
 ) lss on ls.loancontract_no = lss.loancontract_no
 and ls.seq_no = lss.seq_no
left join MBMEMBMASTER mb on mb.member_no = lm.member_no
where lm.coop_id = $P{as_coopid}
 and mb.MEMBER_STATUS = 1
 and mb.RESIGN_STATUS = 0
 and ls.principal_balance > 0
 -- and lm.contract_status = 1
 and trunc(months_between($P{adtm_date},mb.BIRTH_DATE)/12) >= 25
group by case when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) between 25 and 40 then '25 - 40'
 when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) between 41 and 50 then '41 - 50'
 when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) between 51 and 55 then '51 - 55'
 when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) between 56 and 60 then '56 - 60'
 when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) between 61 and 65 then '61 - 65'
 when trunc(months_between(sysdate,mb.BIRTH_DATE)/12) >= 66 then '66'
 else '0' end,
 cm.coop_name
order by age]]>
	</queryString>
	<field name="AGE" class="java.lang.String"/>
	<field name="A1" class="java.math.BigDecimal"/>
	<field name="C1" class="java.math.BigDecimal"/>
	<field name="B1" class="java.math.BigDecimal"/>
	<field name="COOP_NAME" class="java.lang.String"/>
	<variable name="a1_1" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA[$F{A1}]]></variableExpression>
	</variable>
	<variable name="sum_mem" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{A1}]]></variableExpression>
	</variable>
	<variable name="sum_loan" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{B1}]]></variableExpression>
	</variable>
	<variable name="sum_cont" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{C1}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="62" splitType="Stretch">
			<textField>
				<reportElement uuid="a25f98fb-53e6-49f2-a8cc-c06f33e8d7c2" x="0" y="0" width="555" height="22"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Angsana New" size="14" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{COOP_NAME}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="150cbc0b-55b6-4d5f-9f48-6975050ad1fa" x="0" y="22" width="555" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA["รายงานสรุปสมาชิกที่เป็นหนี้ตามช่วงอายุ"]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy">
				<reportElement uuid="ed22adb3-43e6-46de-8774-d111e24f530a" x="0" y="42" width="555" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA["ณ วันที่ "+new SimpleDateFormat("d/MM/yyyy",new Locale("th","TH")).format(new java.util.Date())]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy">
				<reportElement uuid="bd8faef1-798b-48ec-aa5e-31ffddeaf16b" x="472" y="2" width="83" height="20"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Angsana New" size="11"/>
				</textElement>
				<textFieldExpression><![CDATA["วันที่พิมพ์ "+new SimpleDateFormat("d/MM/yyyy",new Locale("th","TH")).format(new java.util.Date())]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="a58411dd-9d5a-4d04-a9fe-d0e384bedfae" x="472" y="22" width="67" height="20"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Angsana New" size="11"/>
				</textElement>
				<textFieldExpression><![CDATA["หน้าที่ "+$V{PAGE_NUMBER}+" /"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement uuid="17e571a0-249c-46b3-a59c-22c7753acfa4" x="539" y="22" width="16" height="20"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Angsana New" size="11"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="40" splitType="Stretch">
			<printWhenExpression><![CDATA[$V{PAGE_NUMBER} == 1 ? false : true]]></printWhenExpression>
			<textField>
				<reportElement uuid="f6eb9459-7109-44ad-bdb7-d087a87190c9" x="472" y="20" width="67" height="20"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Angsana New" size="11"/>
				</textElement>
				<textFieldExpression><![CDATA["หน้าที่ "+$V{PAGE_NUMBER}+" /"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement uuid="3ceede3e-ca72-455f-bd16-ece60da96b27" x="539" y="20" width="16" height="20"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Angsana New" size="11"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy">
				<reportElement uuid="628f2e53-68e6-4eeb-a037-a5c465aa3dc9" x="472" y="0" width="83" height="20"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Angsana New" size="11"/>
				</textElement>
				<textFieldExpression><![CDATA["วันที่พิมพ์ "+new SimpleDateFormat("d/MM/yyyy",new Locale("th","TH")).format(new java.util.Date())]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="22" splitType="Stretch">
			<staticText>
				<reportElement uuid="76d2185c-09d2-45b1-b2a6-c930f5e2e737" x="65" y="1" width="114" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[ช่วงอายุ]]></text>
			</staticText>
			<line>
				<reportElement uuid="b021da7f-36d5-4bf3-b8c0-e62555400065" x="0" y="0" width="555" height="1"/>
			</line>
			<line>
				<reportElement uuid="c27d7389-899f-4647-ae72-255838ab2445" x="0" y="21" width="555" height="1"/>
			</line>
			<staticText>
				<reportElement uuid="ffd38c2b-673d-4776-a536-890ee58d673c" x="0" y="1" width="65" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[ลำดับ]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="0b106220-f644-4d42-b7ca-4df08d4f368e" x="179" y="1" width="78" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[จำนวน]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="50c8fc80-5505-4ad3-806e-e256698d7d67" x="379" y="1" width="176" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[รวมจำนวนเงินกู้]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="b134dad8-708b-4cc4-afce-2dfe67cc7396" x="287" y="2" width="62" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[สัญญา]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="44" splitType="Stretch">
			<textField>
				<reportElement uuid="ff80e9f7-04fe-4a92-a9d5-6caa69e829a8" x="0" y="0" width="65" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" markup="none">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{REPORT_COUNT}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement uuid="e223832f-33fb-47c2-87da-2e5055ba0427" x="65" y="0" width="114" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" markup="none">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{AGE}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement uuid="c66860d6-0561-4673-9558-cb71d50a1390" x="179" y="0" width="78" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{A1}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement uuid="0ce3f63a-5dd3-47ee-8139-a1846099bb82" x="257" y="0" width="30" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[ราย]]></text>
			</staticText>
			<subreport>
				<reportElement uuid="182db66d-0072-4d1d-b052-68ba091ca7ff" x="0" y="20" width="555" height="24"/>
				<subreportParameter name="coop_id">
					<subreportParameterExpression><![CDATA[$P{as_coopid}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="as_age">
					<subreportParameterExpression><![CDATA[$F{AGE}.substring(0, 2)]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="operate_date">
					<subreportParameterExpression><![CDATA[$P{adtm_date}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA["ir_mis_loanbyage_subreport1.jasper"]]></subreportExpression>
			</subreport>
			<staticText>
				<reportElement uuid="5b99d949-1ad3-46f5-94d3-d85dbb1edd74" x="525" y="0" width="30" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[บาท]]></text>
			</staticText>
			<textField pattern="#,##0.00">
				<reportElement uuid="0f39355d-7080-4c6b-a0ad-336b7e27eb6e" x="379" y="0" width="146" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Right">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{B1} == 0 ? 0 : $F{B1}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement uuid="048fb589-7d32-45fe-857e-74f4a62f371f" x="349" y="0" width="30" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[สัญญา]]></text>
			</staticText>
			<textField pattern="#,##0">
				<reportElement uuid="550949d7-246a-443a-ba81-09a1ffbeca3e" x="287" y="0" width="62" height="20"/>
				<box>
					<topPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{C1}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="22" splitType="Stretch">
			<line>
				<reportElement uuid="6c7da5b9-7717-48ac-8f1b-3a22a3b6cce1" x="0" y="0" width="555" height="1"/>
				<graphicElement>
					<pen lineStyle="Dashed"/>
				</graphicElement>
			</line>
			<line>
				<reportElement uuid="8fdc805d-0fbf-4d84-9bc7-f0c1209caa1a" x="0" y="21" width="555" height="1"/>
			</line>
			<staticText>
				<reportElement uuid="8a1acd99-6c81-4815-a885-7eea7a3355bf" x="65" y="1" width="114" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[รวม]]></text>
			</staticText>
			<textField pattern="#,##0">
				<reportElement uuid="c81eb085-1ecc-478e-8992-e57576ad5e7d" x="179" y="1" width="78" height="20"/>
				<box rightPadding="3">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{sum_mem}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement uuid="a80bc106-f095-4778-9fb8-574c91ad8730" x="379" y="2" width="146" height="20"/>
				<box rightPadding="3">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Right">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{sum_loan}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement uuid="c65358b2-9eba-489b-a216-e5845daaed41" x="257" y="1" width="30" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[ราย]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="2e3ee15d-0993-4a76-80d9-63ccb80dbef1" x="525" y="2" width="30" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[บาท]]></text>
			</staticText>
			<staticText>
				<reportElement uuid="2f432981-3de9-4960-910b-c469824e20d0" x="349" y="0" width="30" height="20"/>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<text><![CDATA[สัญญา]]></text>
			</staticText>
			<textField pattern="#,##0">
				<reportElement uuid="cea8f798-6f08-4f64-90ae-d93fac592e35" x="287" y="0" width="62" height="20"/>
				<box rightPadding="3">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center">
					<font fontName="Angsana New" size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{sum_cont}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
